<!DOCTYPE html>
<html lang="fa">
	
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>فروشگاه آنلاین</title>
    <link rel="icon" href="img/favicon.png">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap4-rtl.min.css">
    <!-- animate CSS -->
    <link rel="stylesheet" href="css/animate.css">
    <!-- owl carousel CSS -->
    <link rel="stylesheet" href="css/owl.carousel.min.css">
    <!-- font awesome CSS -->
    <link rel="stylesheet" href="css/all.css">
    <!-- flaticon CSS -->
    <link rel="stylesheet" href="css/flaticon.css">
    <link rel="stylesheet" href="css/themify-icons.css">
    <!-- font awesome CSS -->
    <link rel="stylesheet" href="css/magnific-popup.css">
    <!-- swiper CSS -->
    <link rel="stylesheet" href="css/slick.css">
    <!-- style CSS -->
    <link rel="stylesheet" href="css/style.css">

</head>


<body class="rtl">
	<div class="site-wrap">
		<div class="site-navbar py-2">

			<!-- Start Navbar Section -->
			<div class="container">
				<div class="d-flex align-items-center justify-content-between">
					<div class="main-nav d-none d-lg-block">
						<nav class="site-navigation text-right text-md-center" role="navigation">
							<ul class="site-menu js-clone-nav d-none d-lg-block">

								<!-- ------------------------ -->
								<li><a href="http://127.0.0.1:8000/register/home/">صفحه نخست</a></li>
								<li><a href="http://127.0.0.1:8000/register/login/">ورود</a></li>
								<li><a href="http://127.0.0.1:8000/register/register/">ثبت نام</a></li>
								<li><a href="http://127.0.0.1:8000/register/vendor/">ثبت نام فروشگاه</a></li>
								<li><a href="#" id="user-panel-link">ورود به پنل کاربری</a></li>
								<li><a href="about.html">درباره ما</a></li>
								<li><a href="contact.html">تماس با ما</a></li>
								<li><a href="#" onclick="logout()">خروج</a></li>
								<!-- ------------------------ -->

							</ul>
						</nav>
					</div>
					<div class="icons">
						<a href="#" class="icons-btn d-inline-block js-search-open"><span class="icon-search"></span></a>
						<a href="cart.html" class="icons-btn d-inline-block bag">
							<span class="icon-shopping-bag"></span>
							<span class="number">2</span>
						</a>
						<a href="#" class="site-menu-toggle js-menu-toggle ml-3 d-inline-block d-lg-none"><span class="icon-menu"></span></a>
					</div>
				</div>
			</div>
			<!-- End Navbar Section -->
		</div>

		<!-- Start Product Section -->
		<div class="container">
			<select id="sort-select" class="form-control my-3">
			  <option value="">مرتب سازی</option>
			  <option value="ارزان‌ترین">ارزان‌ترین</option>
			  <option value="گران‌ترین">گران‌ترین</option>
			  <option value="کمترین امتیاز">کمترین امتیاز</option>
			  <option value="بیشترین امتیاز">بیشترین امتیاز</option>
			  <option value="کم فروش‌ترین">کم فروش‌ترین</option>
			  <option value="پر فروش‌ترین">پر فروش‌ترین</option>
			  <option value="قدیمی ترین">قدیمی ترین</option>
			</select>
		  
			<div class="row" id="product-container"></div>
			<div id="pagination" class="my-4"></div>
		  </div>
		  
		<!-- End Product Section -->

		<!-- Start Footer Section -->
		<footer class="site-footer">
			<div class="container">
				<div class="row">
					<div class="col-md-6 col-lg-3 mb-4 mb-lg-0">
						<div class="block-7">
							<h3 class="footer-heading mb-4">درباره ما</h3>
							<p>لورم ایپسوم متن ساختگی با تولید سادگی نامفهوم از صنعت چاپ و با استفاده از طراحان گرافیک است.</p>
						</div>
					</div>

					<div class="col-md-6 col-lg-3">
						<div class="block-5 mb-5">
							<h3 class="footer-heading mb-4">اطلاعات تماس</h3>
							<ul class="list-unstyled">
								<li class="address">شیراز خیابان جام جم</li>
								<li class="phone"><a href="tel://02112345678">02112345678</a></li>
								<li class="email">email@website.com</li>
							</ul>
						</div>
					</div>
				</div>
				<div class="row pt-5 mt-5 text-center">
					<div class="col-md-12">
						<p>
							<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
							Copyright &copy;
							<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="icon-heart" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank"class="text-primary">Colorlib</a>
							<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
							<br>
							فارسی و راست چین شده با <i class="icon-heart" aria-hidden="true"></i> توسط <a href="http://webrubik.com" target="_blank" class="text-primary">Webrubik.com</a>
						</p>
					</div>
				</div>
			</div>
		</footer>
		<!-- End Footer Section -->
	</div>

	<!-- Scripts -->
	<script>

	document.addEventListener('DOMContentLoaded', function () {
	    const productContainer = document.getElementById('product-container');
	    // const sortSelect = document.getElementById('sort-select');
	    const paginationContainer = document.getElementById('pagination');
	    let currentPage = 1;
	    let currentSort = '';
	    function fetchProducts() {
	        let url = `/product/all_product/?page=${currentPage}`;
	        if (currentSort) {
	            url += `&sort=${currentSort}`;
	        }
	        fetch(url)
	            .then(response => response.json())
	            .then(data => {
	                renderProducts(data.results);
	                renderPagination(data.count, data.next, data.previous);
	            })
	            .catch(error => console.error('Error:', error));
	    }
	    function renderProducts(products) {
	        productContainer.innerHTML = '';
	        products.forEach(product => {
	            const productHtml = `
	                <div class="product-card">
	                    <img src="${product.image}" alt="${product.name}" />
	                    <h3>${product.name}</h3>
	                    <p>امتیاز: ${product.rating}</p>
	                    <p>قیمت: ${product.final_price} تومان</p>
	                    ${product.discount > 0 ? `<span class="discount">تخفیف: ${product.discount}%</span>` : ''}
	                </div>
	            `;
	            productContainer.innerHTML += productHtml;
	        });
	    }
	    function renderPagination(count, next, previous) {
	        paginationContainer.innerHTML = '';
	        if (previous) {
	            const prevButton = document.createElement('button');
	            prevButton.textContent = 'صفحه قبل';
	            prevButton.onclick = () => {
	                currentPage--;
	                fetchProducts();
	            };
	            paginationContainer.appendChild(prevButton);
	        }
	        const pageInfo = document.createElement('span');
	        pageInfo.textContent = ` صفحه ${currentPage}`;
	        paginationContainer.appendChild(pageInfo);
	        if (next) {
	            const nextButton = document.createElement('button');
	            nextButton.textContent = 'صفحه بعد';
	            nextButton.onclick = () => {
	                currentPage++;
	                fetchProducts();
	            };
	            paginationContainer.appendChild(nextButton);
	        }
	    }
	    // دسته بندی (مرتب‌سازی)
	    sortSelect.addEventListener('change', function () {
	        const selectedValue = sortSelect.value;
	        switch (selectedValue) {
				// ---------------------------
	            case 'ارزان‌ترین':
	                currentSort = 'cheap';
					break;

				case 'گران‌ترین':
	                currentSort = 'expensive';
	                break;

				case 'کمترین امتیاز':
	                currentSort = 'lowest_score';
	                break;

				case 'بیشترین امتیاز':
	                currentSort = 'highest_score';
	                break;

				case 'کم فروش‌ترین':
	                currentSort = 'badseller';
	                break;

	            case 'پر فروش‌ترین':
	                currentSort = 'bestseller';
	                break;

	            case 'قدیمی ترین':
	                currentSort = 'oldest';
	                break;

	            default:
	                currentSort = '';
	        }
	        currentPage = 1;
	        fetchProducts();
	    });

	    // اولین بار
	    fetchProducts();
	});


		// Logout function
		function logout() {
			localStorage.removeItem("access_token");
			localStorage.removeItem("refresh_token");
			window.location.href = "/register/home/";
		}

		// User panel redirect
		document.addEventListener('DOMContentLoaded', function() {
		    const panelLink = document.getElementById('user-panel-link');
		    if (panelLink) {
		        panelLink.addEventListener('click', function(event) {
		            event.preventDefault();
		            const accessToken = localStorage.getItem("access_token");
		            if (!accessToken) {
		                window.location.href = "http://127.0.0.1:8000/register/login/";
		                return;
		            }
		            fetch("/users/check_user_type/", {
		                method: 'GET',
		                headers: {
		                    "Authorization": `Bearer ${accessToken}`,
		                    "Content-Type": "application/json"
		                }
		            })
		            .then(response => {
		                if (!response.ok) throw new Error("خطا در پاسخ سرور");
		                return response.json();
		            })
		            .then(data => {
		                if (data.is_vendor) {
		                    window.location.href = "http://127.0.0.1:8000/register/vendor_panel/";
		                } else {
		                    window.location.href = "http://127.0.0.1:8000/register/user_panel/";
		                }
		            })
		            .catch(error => {
		                console.error("خطا:", error);
		                window.location.href = "http://127.0.0.1:8000/register/login/";
		            });
		        });
		    }
		});
	</script>

</body>
</html>