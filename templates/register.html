<form id="register-form">
  <input type="text" name="username" placeholder="نام کاربری" required />
  <input type="email" name="email" placeholder="ایمیل" required />
  <input type="password" name="password" placeholder="رمز عبور" required />
  <input type="text" name="phone_number" placeholder="شماره تلفن" required />
  <input type="date" name="birth_date" placeholder="تاریخ تولد" required />
  <label>
    <input type="checkbox" id="is_vendor_checkbox" /> ثبت‌نام به عنوان فروشنده
  </label>
  <div id="vendor-fields" style="display: none;">
    <input type="text" name="vendor_code" placeholder="کد فروشنده" />
  </div>
  <button type="submit">ثبت‌نام</button>
</form>

<script>
  const form = document.getElementById("register-form");
  const isVendorCheckbox = document.getElementById("is_vendor_checkbox");
  const vendorFields = document.getElementById("vendor-fields");

  isVendorCheckbox.addEventListener("change", () => {
    vendorFields.style.display = isVendorCheckbox.checked ? "block" : "none";
  });

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const formData = new FormData(form);
    const data = {
      username: formData.get("username"),
      email: formData.get("email"),
      password: formData.get("password"),
      phone_number: formData.get("phone_number"),
      birth_date: formData.get("birth_date"),
      is_vendor: isVendorCheckbox.checked,
      is_customer: !isVendorCheckbox.checked,
    };

    if (isVendorCheckbox.checked) {
      data.vendor_code = formData.get("vendor_code");
    }

    try {
      const res = await fetch("http://localhost:8000/accounts/register/", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data),
      });

      const responseData = await res.json();

      if (res.ok) {
        alert("ثبت‌نام با موفقیت انجام شد!");


        if (data.is_vendor) {

          window.location.href = "/create-shop.html";
        // } else {
        //   window.location.href = "/success.html";
        }
      } else {
        alert("خطا: " + JSON.stringify(responseData));
      }
    } catch (error) {
      console.error("Error:", error);
      alert("مشکلی در ثبت‌نام رخ داد.");
    }
  });
</script>
